
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>排行榜</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>法喜排行榜</h1>
  <ul id="rankList"></ul>
  <a href="index.html">回首頁</a>

  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      databaseURL: "https://ddm-fy-default-rtdb.asia-southeast1.firebasedatabase.app/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    async function loadRanks() {
      const snapshot = await db.ref('checkins').once('value');
      const data = snapshot.val() || {};
      const users = {};

      for (const day in data) {
        for (const id in data[day]) {
          const rec = data[day][id];
          if (!users[rec.nickname]) users[rec.nickname] = 0;
          users[rec.nickname] += parseInt(rec.count || 1);
        }
      }

      const sorted = Object.entries(users).sort((a, b) => b[1] - a[1]);
      const list = document.getElementById("rankList");
      sorted.forEach(([name, count], i) => {
        const li = document.createElement("li");
        li.textContent = `第${i+1}名：${name}（${count}次）`;
        list.appendChild(li);
      });
    }

    loadRanks();
  </script>
</body>
</html>
